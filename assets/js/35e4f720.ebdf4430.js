"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[16591],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),o=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=o(e.components);return r.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),h=o(n),d=a,c=h["".concat(p,".").concat(d)]||h[d]||m[d]||s;return n?r.createElement(c,i(i({ref:t},u),{},{components:n})):r.createElement(c,i({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,i=new Array(s);i[0]=h;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var o=2;o<s;o++)i[o]=n[o];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},42206:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return d},frontMatter:function(){return l},metadata:function(){return o},toc:function(){return m}});var r=n(87462),a=n(63366),s=(n(67294),n(3905)),i=["components"],l={id:"skyhash",title:"Skyhash 2.0"},p=void 0,o={unversionedId:"protocol/skyhash",id:"protocol/skyhash",title:"Skyhash 2.0",description:"Copyright (c) 2022 Sayan Nandan &lt;nandansayan@outlook.com&lt;",source:"@site/docs/protocol/skyhash.md",sourceDirName:"protocol",slug:"/protocol/skyhash",permalink:"/next/protocol/skyhash",tags:[],version:"current",frontMatter:{id:"skyhash",title:"Skyhash 2.0"},sidebar:"docs",previous:{title:"WHEREAMI",permalink:"/next/actions/whereami"},next:{title:"Data types",permalink:"/next/protocol/data-types"}},u={},m=[{value:"Concepts",id:"concepts",level:2},{value:"Simple queries",id:"simple-queries",level:2},{value:"Queries",id:"queries",level:3},{value:"The Metaframe",id:"the-metaframe",level:4},{value:"The Dataframe",id:"the-dataframe",level:4},{value:"Example: A complete simple query",id:"example-a-complete-simple-query",level:4},{value:"Responses",id:"responses",level:3},{value:"An example response",id:"an-example-response",level:4},{value:"Pipelined queries",id:"pipelined-queries",level:2},{value:"Queries",id:"queries-1",level:3},{value:"The Metaframe",id:"the-metaframe-1",level:4},{value:"The Dataframe",id:"the-dataframe-1",level:4},{value:"Example: A complete pipelined query",id:"example-a-complete-pipelined-query",level:3},{value:"Responses",id:"responses-1",level:3}],h={toc:m};function d(e){var t=e.components,n=(0,a.Z)(e,i);return(0,s.kt)("wrapper",(0,r.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"About this document")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"Copyright (c) 2022 Sayan Nandan ","<",(0,s.kt)("a",{parentName:"p",href:"mailto:nandansayan@outlook.com"},"nandansayan@outlook.com"),"<",(0,s.kt)("br",{parentName:"p"}),"\n",(0,s.kt)("strong",{parentName:"p"},"In effect since:")," 0.8.0",(0,s.kt)("br",{parentName:"p"}),"\n",(0,s.kt)("strong",{parentName:"p"},"Date:")," 15",(0,s.kt)("sup",null,"th")," April, 2022"))),(0,s.kt)("p",null,"Skyhash 2.0 is a protocol built on top of TCP that is used by Skytable for client-server communication. All clients willing to communicate with Skytable must implement this specification. Skyhash 2.0 supersedes the\nnow deprecated ",(0,s.kt)("a",{parentName:"p",href:"deprecated/skyhash-1.0"},"Skyhash 1.0 protocol"),"."),(0,s.kt)("h2",{id:"concepts"},"Concepts"),(0,s.kt)("p",null,"Skyhash uses a query/response action just like HTTP's request/response action ","\u2014","\xa0clients send queries and the server returns responses. The bytes sent by a client to the server is called a ",(0,s.kt)("em",{parentName:"p"},"query packet")," while the bytes returned by the server to the client is called a ",(0,s.kt)("em",{parentName:"p"},"response packet"),"."),(0,s.kt)("p",null,"As of Skyhash 2.0, there are two kinds of queries;"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Simple queries:")," In these kinds of queries, the client sends a single query and the server responds\nwith a single response"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Pipelined queries:")," In these kinds of queries, the client sends multiple queries in a single query and the server returns multiple responses in the same responses, in the order the queries were sent")),(0,s.kt)("h2",{id:"simple-queries"},"Simple queries"),(0,s.kt)("p",null,"This section explains the structure of simple queries and responses"),(0,s.kt)("h3",{id:"queries"},"Queries"),(0,s.kt)("p",null,"A simple query is used to run a single query. A simple query is made up of two parts:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"The Metaframe"),(0,s.kt)("li",{parentName:"ol"},"The Dataframe")),(0,s.kt)("h4",{id:"the-metaframe"},"The Metaframe"),(0,s.kt)("p",null,"The metaframe of a simple query has the following structure:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"*<count>\\n\n")),(0,s.kt)("p",null,"Here:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"*")," tells the server that this is a simple query"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<count>")," specifies the number of elements in the simple query"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"\\n")," terminates the metaframe")),(0,s.kt)("h4",{id:"the-dataframe"},"The Dataframe"),(0,s.kt)("p",null,"The dataframe of a simple query has the following general structure:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"<l>\\n\n<e>\n...\n")),(0,s.kt)("p",null,"Here:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<l>")," indicates the number of bytes in the element and is newline terminated (",(0,s.kt)("inlineCode",{parentName:"li"},"\\n"),")"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<e>")," is the element itself")),(0,s.kt)("p",null,"This is repeated for all the elements, something like:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"<l1>\\n\n<e1>\n<l2>\\n\n<e2>\n...\n")),(0,s.kt)("h4",{id:"example-a-complete-simple-query"},"Example: A complete simple query"),(0,s.kt)("p",null,"We need to send: ",'["SET", "x", "100"]'),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"*    -> Simple query\n3\\n  -> Query 1 has 3 elements\n3\\n  -> E1 has 3 bytes\nSET  -> E1 itself\n1\\n  -> E2 has 1 byte\nx    -> E2 itself\n3\\n  -> E3 has 3 bytes\n100  -> E3 itself\n")),(0,s.kt)("h3",{id:"responses"},"Responses"),(0,s.kt)("p",null,"Simple responses are returned as responses to simple queries. There is one thing about responses: unlike queries where the server doesn't bother with types, responses however ",(0,s.kt)("strong",{parentName:"p"},"are strongly typed"),". The returned data types have their structures, all of which you can see in ",(0,s.kt)("a",{parentName:"p",href:"data-types"},"this document"),". Responses have the following general structure:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"*\n<type><length>\\n\n<data>\n")),(0,s.kt)("p",null,"Here:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"*"),": Tells the client that this is a response to a simple query. This comprises the entire response metaframe"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<type>")," Is the type symbol (see ",(0,s.kt)("a",{parentName:"li",href:"data-types"},"this document"),")"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<length>"),": Number of bytes in the element. For collections, this specifies the length of the collection while lengths for individual elements follow. Some types might not have lengths but are newline terminated instead")),(0,s.kt)("h4",{id:"an-example-response"},"An example response"),(0,s.kt)("p",null,"The below response is returned when the servers responds with ",(0,s.kt)("inlineCode",{parentName:"p"},"Respcode 0")," (Okay):"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"*   -> simple response\n!   -> the returned value is a respmessage\n0\\n -> The respmessage is 0, which is respcode 0 (Okay)\n")),(0,s.kt)("p",null,"Here:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"*"),": This is a response to a simple query"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"!"),": This is the type symbol for Response Messages. Response codes"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"0"),": This is the response code, newline terminated (",(0,s.kt)("inlineCode",{parentName:"li"},"\\n"),")")),(0,s.kt)("p",null,"Here is another responses to something like ",(0,s.kt)("inlineCode",{parentName:"p"},"GET x")," that returns ",(0,s.kt)("inlineCode",{parentName:"p"},"100")," as a string:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"*     -> simple response\n+3\\n  -> unicode string with 3 bytes\n100   -> the element\n")),(0,s.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"Consider reading ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"data-types"},"this document on data types"))," to learn about the structure of each response data type."))),(0,s.kt)("h2",{id:"pipelined-queries"},"Pipelined queries"),(0,s.kt)("p",null,"This section explains the structure of pipelined queries and responses."),(0,s.kt)("h3",{id:"queries-1"},"Queries"),(0,s.kt)("p",null,"Pipelined queries are used to run multiple queries at once. Responses are returned in the order they are sent. A pipeline is also made up of two parts:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Metaframe"),(0,s.kt)("li",{parentName:"ol"},"Dataframe")),(0,s.kt)("h4",{id:"the-metaframe-1"},"The Metaframe"),(0,s.kt)("p",null,"The metaframe of a pipelined query has the following general structure:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"$<count>\\n\n")),(0,s.kt)("p",null,"Here:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"$"),": This tells the server that this is a pipelined query"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"<count>"),": The number of queries in this pipeline, newline terminated (",(0,s.kt)("inlineCode",{parentName:"li"},"\\n"),")")),(0,s.kt)("h4",{id:"the-dataframe-1"},"The Dataframe"),(0,s.kt)("p",null,"The dataframe of a pipelined query is simply a collection of simple query dataframes. It resembles the following structure:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"<query 1 element count>\\n\n<--- query 1 dataframe ---\x3e\n<query 2 element count>\\n\n<--- query 2 dataframe ---\x3e\n...\n")),(0,s.kt)("h3",{id:"example-a-complete-pipelined-query"},"Example: A complete pipelined query"),(0,s.kt)("p",null,"Here, we are sending two queries:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Query 1:")," ",(0,s.kt)("inlineCode",{parentName:"li"},"SET x 100")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Query 2:")," ",(0,s.kt)("inlineCode",{parentName:"li"},"GET x"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"$    -> Pipeline\n2\\n  -> Pipeline has 2 queries\n\n3\\n  -> Query 1 has 3 elements\n3\\n  -> Q1E1 has 3 bytes\nSET  -> Q1E1 itself\n1\\n  -> Q1E2 has 1 byte\nx    -> Q1E2 itself\n3\\n  -> Q1E3 has 3 bytes\n100  -> Q1E3 itself\n\n2\\n  -> Query 2 has 2 elements\n3\\n  -> Q2E1 has 3 bytes\nGET  -> Q2E1 itself\n1\\n  -> Q2E2 has 1 byte\nx    -> Q2E2 itself\n")),(0,s.kt)("h3",{id:"responses-1"},"Responses"),(0,s.kt)("p",null,"Pipelined responses are responses returned in responses to a pipelined query. Just like ",(0,s.kt)("a",{parentName:"p",href:"#simple-responses"},"simple responses"),", they are typed."),(0,s.kt)("p",null,"Example response:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'$    -> Pipeline response\n2\\n  -> Two responses are returned\n!0\\n -> First response is respcode 0\n+3\\n -> Second response is a string with 3 bytes\n100  -> The string itself ("100") here\n')))}d.isMDXComponent=!0}}]);